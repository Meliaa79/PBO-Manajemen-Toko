/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JPanel.java to edit this template
 */
package View;

import java.sql.Connection;
import java.sql.ResultSet;
import java.sql.Statement;
import java.text.SimpleDateFormat;
import java.util.Date;
import javax.swing.JOptionPane;
import javax.swing.table.DefaultTableModel;

/**
 *
 * @author M E L I A
 */
public class Pembelian extends javax.swing.JPanel {
    public Statement st;
    public ResultSet rs;
    Connection connection = config.koneksi.getConnection();
    /**
     * Creates new form Pembelian
     */
    public Pembelian() {
        initComponents();
        TampilData();
    }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jLabel1 = new javax.swing.JLabel();
        jLabel2 = new javax.swing.JLabel();
        jLabel3 = new javax.swing.JLabel();
        jLabel4 = new javax.swing.JLabel();
        jLabel5 = new javax.swing.JLabel();
        jLabel6 = new javax.swing.JLabel();
        jLabel7 = new javax.swing.JLabel();
        jLabel8 = new javax.swing.JLabel();
        jScrollPane1 = new javax.swing.JScrollPane();
        tabel_data = new javax.swing.JTable();
        t_pembelian = new javax.swing.JTextField();
        combo_supplier = new javax.swing.JComboBox<>();
        combo_produk = new javax.swing.JComboBox<>();
        jdate = new com.toedter.calendar.JDateChooser();
        t_jumlah = new javax.swing.JTextField();
        t_harga = new javax.swing.JTextField();
        t_totalharga = new javax.swing.JTextField();
        t_date = new javax.swing.JButton();
        btn_jumlahharga = new javax.swing.JButton();
        btn_simpan = new javax.swing.JButton();
        btn_hapus = new javax.swing.JButton();
        btn_batal = new javax.swing.JButton();

        setBackground(new java.awt.Color(204, 204, 204));
        setMaximumSize(new java.awt.Dimension(590, 470));
        setMinimumSize(new java.awt.Dimension(590, 470));
        setLayout(new org.netbeans.lib.awtextra.AbsoluteLayout());

        jLabel1.setFont(new java.awt.Font("SansSerif", 1, 18)); // NOI18N
        jLabel1.setText("DATA PEMBELIAN ");
        add(jLabel1, new org.netbeans.lib.awtextra.AbsoluteConstraints(200, 10, -1, -1));

        jLabel2.setText("Id_pembelian");
        add(jLabel2, new org.netbeans.lib.awtextra.AbsoluteConstraints(20, 50, -1, -1));

        jLabel3.setText("Id_supplier");
        add(jLabel3, new org.netbeans.lib.awtextra.AbsoluteConstraints(20, 90, -1, -1));

        jLabel4.setText("Nama_Produk");
        add(jLabel4, new org.netbeans.lib.awtextra.AbsoluteConstraints(20, 130, -1, -1));

        jLabel5.setText("Tanggal");
        add(jLabel5, new org.netbeans.lib.awtextra.AbsoluteConstraints(20, 170, -1, -1));

        jLabel6.setText("Jumlah");
        add(jLabel6, new org.netbeans.lib.awtextra.AbsoluteConstraints(20, 210, -1, -1));

        jLabel7.setText("Harga");
        add(jLabel7, new org.netbeans.lib.awtextra.AbsoluteConstraints(20, 250, -1, -1));

        jLabel8.setText("Total_Harga");
        add(jLabel8, new org.netbeans.lib.awtextra.AbsoluteConstraints(20, 280, -1, -1));

        tabel_data.setModel(new javax.swing.table.DefaultTableModel(
            new Object [][] {
                {null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null},
                {null, null, null, null, null, null, null}
            },
            new String [] {
                "Id_pembelian", "Id_supplier", "Id_produk", "Tanggal", "Jumlah", "Harga", "Total_Harga"
            }
        ));
        tabel_data.addMouseListener(new java.awt.event.MouseAdapter() {
            public void mouseClicked(java.awt.event.MouseEvent evt) {
                tabel_dataMouseClicked(evt);
            }
        });
        jScrollPane1.setViewportView(tabel_data);

        add(jScrollPane1, new org.netbeans.lib.awtextra.AbsoluteConstraints(10, 340, 530, 110));
        add(t_pembelian, new org.netbeans.lib.awtextra.AbsoluteConstraints(170, 50, 170, -1));

        combo_supplier.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "-Pilih Supplier-", "sup01", "sup02", "sup03", "sup04", " " }));
        add(combo_supplier, new org.netbeans.lib.awtextra.AbsoluteConstraints(170, 80, 170, -1));

        combo_produk.setModel(new javax.swing.DefaultComboBoxModel<>(new String[] { "-Pilih Produk-", "Mizone", "Teh Botol", "Teh Pucuk", "Aqua", "Pocari", "Beras 25kg", "Gula", "Minyak", "Kopi", "Susu", "Sunlight ", "Sapu", " " }));
        combo_produk.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                combo_produkActionPerformed(evt);
            }
        });
        add(combo_produk, new org.netbeans.lib.awtextra.AbsoluteConstraints(170, 120, 170, -1));
        add(jdate, new org.netbeans.lib.awtextra.AbsoluteConstraints(170, 160, 170, -1));
        add(t_jumlah, new org.netbeans.lib.awtextra.AbsoluteConstraints(170, 200, 170, -1));
        add(t_harga, new org.netbeans.lib.awtextra.AbsoluteConstraints(170, 240, 170, -1));
        add(t_totalharga, new org.netbeans.lib.awtextra.AbsoluteConstraints(170, 280, 170, -1));

        t_date.setText("GET");
        t_date.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                t_dateActionPerformed(evt);
            }
        });
        add(t_date, new org.netbeans.lib.awtextra.AbsoluteConstraints(350, 160, -1, -1));

        btn_jumlahharga.setText("HITUNG JUMLAH HARGA");
        btn_jumlahharga.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btn_jumlahhargaActionPerformed(evt);
            }
        });
        add(btn_jumlahharga, new org.netbeans.lib.awtextra.AbsoluteConstraints(350, 260, -1, -1));

        btn_simpan.setText("SIMPAN");
        btn_simpan.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btn_simpanActionPerformed(evt);
            }
        });
        add(btn_simpan, new org.netbeans.lib.awtextra.AbsoluteConstraints(50, 310, -1, -1));

        btn_hapus.setText("HAPUS");
        btn_hapus.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btn_hapusActionPerformed(evt);
            }
        });
        add(btn_hapus, new org.netbeans.lib.awtextra.AbsoluteConstraints(150, 310, -1, -1));

        btn_batal.setText("BATAL");
        btn_batal.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                btn_batalActionPerformed(evt);
            }
        });
        add(btn_batal, new org.netbeans.lib.awtextra.AbsoluteConstraints(250, 310, -1, -1));
    }// </editor-fold>//GEN-END:initComponents

    private void combo_produkActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_combo_produkActionPerformed
        switch(combo_produk.getSelectedIndex()) {
            case 1:
            {
                t_harga.setText(String.valueOf("5000"));
            }
            break;
            case 2:
            {
                t_harga.setText(String.valueOf("3000"));
            }
            break;
            case 3:
            {
                t_harga.setText(String.valueOf("4000"));
            } break;
            case 4:
            {
                t_harga.setText(String.valueOf("3000"));
            } break;
            case 5:
            {
                t_harga.setText(String.valueOf("6000"));
            } break;
            case 6: 
            {
                t_harga.setText(String.valueOf("25000"));
            } break;
            case 7: 
            {
                t_harga.setText(String.valueOf("12000"));
            } break;
            case 8: 
            {
                t_harga.setText(String.valueOf("16000"));
            }
            break;
            case 9:
            {
                t_harga.setText(String.valueOf("3000"));
            }
            break;
            case 10:
            {
                t_harga.setText(String.valueOf("7000"));
            }
            break;
            case 11:
            {
                t_harga.setText(String.valueOf("5000"));
            }
            break;
            case 12:
            {
                t_harga.setText(String.valueOf("13000"));
            }
        }
    }//GEN-LAST:event_combo_produkActionPerformed

    private void btn_jumlahhargaActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btn_jumlahhargaActionPerformed
        Double harga, jumlahbeli, hargatotal;
                harga=Double.parseDouble(t_harga.getText());
                jumlahbeli=Double.parseDouble(t_jumlah.getText());
                hargatotal=harga*jumlahbeli;
                t_totalharga.setText(String.valueOf(hargatotal));
    }//GEN-LAST:event_btn_jumlahhargaActionPerformed

    private void btn_batalActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btn_batalActionPerformed
        t_pembelian.setText("");
        t_date.setText("");
        t_jumlah.setText("");
        t_harga.setText("");
        t_totalharga.setText("");
            
    }//GEN-LAST:event_btn_batalActionPerformed

    private void btn_hapusActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btn_hapusActionPerformed
        if (t_pembelian.getText().equals("")) {
            JOptionPane.showMessageDialog(this, "Silahkan pilih data yang akan dihapus"); 
        } else {
            int jawab = JOptionPane.showConfirmDialog(null, "Apakah yakin menghapus data ini?", "Konfirmasi", JOptionPane.YES_NO_OPTION);
            if (jawab == 0) {
                try {
                    st = connection.createStatement();
                    String sql = "DELETE FROM tb_pembelian WHERE Id_pembelian = '" + t_pembelian.getText() + "'";
                    st.executeUpdate(sql);
                    JOptionPane.showMessageDialog(null, "Data berhasil dihapus");
                    TampilData();
                    //Bersih();
                    
                } catch (Exception e) {
                     JOptionPane.showMessageDialog(null, e);
                }
                
            }
        }
    }//GEN-LAST:event_btn_hapusActionPerformed

    private void btn_simpanActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_btn_simpanActionPerformed
        try {
        st = connection.createStatement();
        //rs = st.executeQuery("SELECT * FROM tb_supplier");
        System.out.println("Memulai proses penyimpanan data...");

        if (connection == null || connection.isClosed()) {
            JOptionPane.showMessageDialog(null, "Koneksi ke database tidak tersedia", "Koneksi Error", JOptionPane.ERROR_MESSAGE);
            return;
        }

        System.out.println("Koneksi ke database berhasil...");

        if (t_pembelian.getText().equals("") || 
                combo_supplier.getSelectedItem() == null ||
                combo_produk.getSelectedItem() == null ||
                t_date.getText().equals("") || 
                t_jumlah.getText().equals("") || 
                t_harga.getText().equals("") ||
                t_totalharga.getText().equals("")) {
            JOptionPane.showMessageDialog(null, "Data tidak boleh kosong", "Validasi Data", JOptionPane.INFORMATION_MESSAGE);
            return;
        }

        System.out.println("Validasi data berhasil...");

        st = connection.createStatement();

        if (btn_simpan.getText().equals("SIMPAN")) {
            System.out.println("Mode Simpan...");
            String cek = "SELECT * FROM tb_pembelian WHERE Id_pembelian = '" + t_pembelian.getText() + "'";
            rs = st.executeQuery(cek);

            if (rs.next()) {
                JOptionPane.showMessageDialog(null, "Maaf..Id_transaksi ini sudah ada");
            } else {
                String sql = "INSERT INTO tb_pembelian (Id_pembelian, Id_supplier, Nama_Produk, Tanggal, Jumlah, Harga, Total_Harga) VALUES ('" + 
                        t_pembelian.getText() + "','" + 
                        combo_supplier.getSelectedItem() + "','" + 
                        combo_produk.getSelectedItem() + "','" + 
                        t_date.getText() + "','" + 
                        t_jumlah.getText() + "','" + 
                        t_harga.getText() + "','" + 
                        t_totalharga.getText() + "')"; 
                        
                        
                st.executeUpdate(sql);
                JOptionPane.showMessageDialog(null, "Data berhasil disimpan");
                //Bersih();
                TampilData();
            }
            
        
        } else {
                //aksi ubah data
                    String update = "UPDATE tb_pembelian SET Tanggal = '" + t_date.getText() +                         
                            "', Jumlah = '" + t_jumlah.getText() +
                             "', Harga = '" + t_harga.getText() +
                            "', Total_Harga = '" + t_totalharga.getText() + "'";
                    st.executeLargeUpdate(update);
                    JOptionPane.showMessageDialog(null, "Data berhasil diubah");
                    //Bersih();
                    TampilData();
                    }

        if (rs != null) rs.close();
        if (st != null) st.close();

        System.out.println("Proses penyimpanan selesai...");

    } catch (Exception e) {
        JOptionPane.showMessageDialog(null, "SQL Error: " + e.getMessage());
    }
        
    }//GEN-LAST:event_btn_simpanActionPerformed

    private void tabel_dataMouseClicked(java.awt.event.MouseEvent evt) {//GEN-FIRST:event_tabel_dataMouseClicked
        t_pembelian.setText(tabel_data.getValueAt(tabel_data.getSelectedRow(), 1).toString());
        t_date.setText(tabel_data.getValueAt(tabel_data.getSelectedRow(), 4).toString());
        t_jumlah.setText(tabel_data.getValueAt(tabel_data.getSelectedRow(), 5).toString());
        t_harga.setText(tabel_data.getValueAt(tabel_data.getSelectedRow(), 6).toString());
        t_totalharga.setText(tabel_data.getValueAt(tabel_data.getSelectedRow(), 7).toString());
        
        
        t_pembelian.setEditable(false);
        btn_simpan.setText("UBAH");
    }//GEN-LAST:event_tabel_dataMouseClicked

    private void t_dateActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_t_dateActionPerformed
        Date selectDate = jdate.getDate();
        SimpleDateFormat dateFormat = new SimpleDateFormat("yyyy//MM//dd");
        String formatDate = dateFormat.format(selectDate);
        t_date.setText(formatDate);
    }//GEN-LAST:event_t_dateActionPerformed

    private void TampilData() {
    try {
        st = connection.createStatement();
        rs = st.executeQuery("SELECT * FROM tb_pembelian");

        DefaultTableModel model = new DefaultTableModel();
        model.addColumn("No.");
        model.addColumn("Id_pembelian");
        model.addColumn("Id_supplier");
        model.addColumn("Nama_Produk");
        model.addColumn("Tanggal");
        model.addColumn("Jumlah");
        model.addColumn("Harga");
        model.addColumn("Total_Harga");
        

        int no = 1;

        model.getDataVector().removeAllElements();
        model.fireTableDataChanged();
        model.setRowCount(0);

        while (rs.next()) {
            Object[] data = {
                no++,
                rs.getString("Id_pembelian"),
                rs.getString("Id_supplier"),
                rs.getString("Nama_Produk"),
                rs.getString("Tanggal"),
                rs.getString("Jumlah"),
                rs.getString("Harga"),
                rs.getString("Total_Harga"),
                
            };
            model.addRow(data);
        }
        
        tabel_data.setModel(model);

        if (rs != null) rs.close();
        if (st != null) st.close();
        
    } catch (Exception e) {
        JOptionPane.showMessageDialog(null, e);
    }
}


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton btn_batal;
    private javax.swing.JButton btn_hapus;
    private javax.swing.JButton btn_jumlahharga;
    private javax.swing.JButton btn_simpan;
    private javax.swing.JComboBox<String> combo_produk;
    private javax.swing.JComboBox<String> combo_supplier;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JLabel jLabel3;
    private javax.swing.JLabel jLabel4;
    private javax.swing.JLabel jLabel5;
    private javax.swing.JLabel jLabel6;
    private javax.swing.JLabel jLabel7;
    private javax.swing.JLabel jLabel8;
    private javax.swing.JScrollPane jScrollPane1;
    private com.toedter.calendar.JDateChooser jdate;
    private javax.swing.JButton t_date;
    private javax.swing.JTextField t_harga;
    private javax.swing.JTextField t_jumlah;
    private javax.swing.JTextField t_pembelian;
    private javax.swing.JTextField t_totalharga;
    private javax.swing.JTable tabel_data;
    // End of variables declaration//GEN-END:variables
}
